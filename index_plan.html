<!DOCTYPE html>
<html lang="fr">
    <head>
     <meta charset="utf-8"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>
      

  <!-- Load jQuery and PapaParse to read data from a CSV file -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>

      <style>
        #map{ width: 900px; height: 500px; }
      </style>
    </head>


<body>

<h3>Où peut-on aller manger ?</h3>
<p>Découvrons le choix local, tout en sachant quel lieu a déjà été expérimenté par qui ! </p>


  <div id="map"  style="height:100vh;width:100%">    
  </div>


</body>


  <script>
  // initialize the map
    var map = L.map('map').setView([48.5856, 7.7405], 16); //Halles

    var osmLayer = L.tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png', { // LIGNE 20
        attribution: '© OpenStreetMap contributors',
        maxZoom: 19
    });

  /* Control panel to display map layers */
  var controlLayers = L.control.layers( null, null, {
    position: "topright",
    collapsed: false
  }).addTo(map);



    map.addLayer(osmLayer);


    var useIcon = 'foodIcon.png';

    var useIcons = [];



    var picIcons = [];

   for (let i=0;  i<=5 ; i++) {
    let iconLink = 'foodIcon' + i.toString() + '.png';

      picIcons.push(
        L.icon({
          iconUrl: iconLink,
          iconSize: [27,38]
        })
      )
    } 



    $.get('https://www.onvamangerou.fr/dataOSM.csv', function(csvString) {

    let pointGroupLayer = L.layerGroup().addTo(map);

    // Use PapaParse to convert string to array of objects
    var data = Papa.parse(csvString, {header: true, dynamicTyping: true}).data;    
    // For each row in data, create a marker and add it to the map
    // For each row, columns `Latitude`, `Longitude`, and `Title` are required
    for (var i in data) {
      var row = data[i];
      let marker;
      marker = L.marker([row.latitude, row.longitude])
      marker.setIcon(
        picIcons[0]
      );
      marker.bindTooltip(row.name + "</br>" + 
        ((row.cuisine == null) ? '/' : row.cuisine + " food")
      );

      marker.addTo(pointGroupLayer);
    }
  });
  </script>


